Update the existing sales acquisition tool backend to incorporate the following changes, while keeping the overall structure (Express.js with routes.ts, index.ts, storage.ts, vite.ts, and schema.ts). The goal is to improve OCR accuracy, make customer data flexible and editable externally, and adjust the API responses for better frontend integration. Do not change the frontend unless specified.





Replace Tesseract.js OCR with Google Cloud Vision API for text detection:





Install the '@google-cloud/vision' package via npm.



Require a new environment secret: GOOGLE_CLOUD_VISION_KEY (a JSON service account key from Google Cloud Console, enabling Vision API).



In routes.ts, for the /api/ocr endpoint:





Use Vision's textDetection on the uploaded image buffer (req.file.buffer).



Extract the full text and parse it into an array of resident names (anwohnerdaten), assuming Vision returns text with line breaks or blocks for grouping words on the same nameplate (e.g., split by lines or detect word groupings as separate entries).



Each detected name should be an element in the array; if multiple words belong to one resident (e.g., "Max Müller"), keep them space-separated as one string element.



Include the full Vision response in the output for debugging (e.g., add 'fullVisionResponse' to the JSON).



Keep multer for image upload.



Replace the in-memory storage with Google Sheets integration for customer data:





Install the 'googleapis' package via npm.



Require a new environment secret: GOOGLE_SHEETS_KEY (a JSON service account key 'token_sheets.json' with Sheets API enabled and shared access to the sheet).



Use Google Sheet with ID '1IF9ieZQ_irKs9XU7XZmDuBaT4XqQrtm0EmfKbA3zB4s', and worksheet 'Customers' with columns: Name (string), Straße, Hausnummer, Postleitzahl.



All customers in this sheet are existing (implicitly isExisting: true).



Remove the MemStorage class in storage.ts. Instead, implement IStorage methods to query/update the Sheet via google.sheets v4 API on each call (e.g., use spreadsheets.values.get for reading all customers, append for creating new if needed).



For getCustomerByName: Search in the fetched data (case-insensitive).



For createCustomer: Append a new row to the Sheet (but do not create new customers automatically in /api/ocr; only report prospects).



Seed/initial data: No hardcoding; assume the user manages data in Sheets.



For efficiency: Cache results in-memory for 5 minutes if needed, but keep it simple.



When matching customers: Filter by address if provided (match Straße, Hausnummer, Postleitzahl case-insensitively).



Adjust API responses and add address integration:





Modify /api/ocr to optionally accept 'address' in the request body (as JSON alongside the image multipart).



In the response: { residentNames: string[] (array of parsed anwohnerdaten/names from OCR, with each entry as space-separated words for one resident; replace characters like '-' with spaces), fullVisionResponse: object, newProspects: string[] (resident names that do not match any existing customer), existingCustomers: Customer[] (matching customers from Sheets, filtered by address if provided) }.



For matching: Convert all to lowercase; a resident is recognized as an existing customer if any word in the resident name matches any word in a Sheet customer's Name (not case-sensitive).



Remove creating new customers automatically; only report prospects.



Keep /api/geocode as is.



Update /api/customers to fetch from Sheets.



Add frontend support for OCR correction:





In the scanner.tsx (or main frontend page): After receiving OCR response, display the 'residentNames' as editable text inputs.



Add a "Correct and Resubmit" button that sends a new POST to /api/ocr-correct (new endpoint in routes.ts) with corrected names and address.



The /api/ocr-correct endpoint: Takes { residentNames: string[], address?: Address }, performs the customer lookup (from Sheets) with the same matching logic, and returns the same format as /api/ocr but without OCR (skip Vision).

Ensure bilingual support (German/English) remains. Test the full flow: GPS to address, photo upload to OCR, correction, and customer lookup. Provide updated documentation in replit.md.